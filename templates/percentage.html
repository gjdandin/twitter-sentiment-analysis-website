<!doctype html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">
    <style>
        .samples {
            display: flex;
            flex-direction: column;
            margin: auto;
            align-items: center;
        }

        .sample {
            width: 400px !important;
        }

        .sample iframe {
            border: none !important;
            box-shadow: none !important;
        }
    </style>
    <script>
    function cb() {
        let searchterm = $("#searchterm").val()
        let numsearch = $("#numsearch").val()

        req = $.ajax({
                url : "/callback",
                type : "GET",
                data : {'searchterm':searchterm, 'numsearch':numsearch}
        });

        req.done(function(data) {
            $("#piechart").fadeOut(100).fadeIn(100);
            $("#barchart").fadeOut(100).fadeIn(100);
            var graphs = JSON.parse(data);
            Plotly.react('piechart', JSON.parse(graphs.piegraphJSON), {});
            Plotly.react('barchart', JSON.parse(graphs.bargraphJSON), {});

            var positive_sample_div = document.getElementById('positive-sample');
            var negative_sample_div = document.getElementById('negative-sample');
            var neutral_sample_div = document.getElementById('neutral-sample');

            console.log(graphs.positivesamplecounts);
            console.log(graphs.negativesamplecounts);
            console.log(graphs.neutralsamplecounts);

            createsample(graphs.positivesample,graphs.positivesamplecounts, positive_sample_div);
            createsample(graphs.negativesample,graphs.negativesamplecounts, negative_sample_div);
            createsample(graphs.neutralsample,graphs.neutralsamplecounts, neutral_sample_div);
        });
    }
</script>
</head>

<body>
  <h1>Twitter Sentiment Analysis</h1>
  <div id="inputs">
      <label for="searchterm">Insert hashtag:</label>
      <input type="text" id="searchterm" name="searchterm">
      <label for="numsearch">Insert how many tweets to analyze(max 100):</label>
      <input type="text" id="numsearch" name="numsearch">
      <button id="submit" onclick="cb()">Submit query</button>
  </div>

  <div id='piechart' class='piechart'></div>
  <div id='barchart' class='barchart'></div>

  <h3>Some samples from the analyzed data:</h3>
  <div id="twitter-wjs" class="samples">
     <div id="positive-sample-div" class="sample"><h4>Positive tweet:</h4><div id="positive-sample"></div></div>
     <div id="negative-sample-div" class="sample"><h4>Negative tweet:</h4><div id="negative-sample"></div></div>
     <div id="neutral-sample-div" class="sample"><h4>Neutral tweet:</h4><div id="neutral-sample"></div></div>
 </div>
</body>
<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type='text/javascript'>
    // Show graphs
  var piegraph = {{piegraphJSON | safe}};
  var bargraph = {{bargraphJSON | safe}};
  Plotly.plot('piechart',piegraph,{});
  Plotly.plot('barchart',bargraph,{});
</script>

<script>
    function createsample(sample, sample_counts, sample_div) {
        // Embed sentiment tweet from results
        sample = JSON.parse(sample);

        let ut = "";
        if (sample_counts == 0){
            ut = "<p>" + "Sample not found - no tweet example with this reaction from your search."
            sample_div.innerHTML = ut;
        }
        else {
            ut = "<p>" + "User " + sample.author + " tweets: " + "\n" + sample.text + "\n" + "Created at: " + sample.created_at + "</p>"
            sample_div.innerHTML = ut;
        }
    }
</script>
</html>